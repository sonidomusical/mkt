<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Reproductor de Música Pro</title>

	<meta property="og:title" content="Reproductor de Música Pro" />
	<meta property="og:description" content="El fin de todo el discurso que has oído es: Teme a Dios y guarda sus mandamientos, porque esto es el todo del hombre. Pues Dios traerá toda obra a juicio, juntamente con toda cosa oculta, sea buena o sea mala." />
	<meta property="og:url" content="https://generalonepe.github.io/mkt" />
	<meta property="og:site_name" content="Eclesiastés 12:13-14" />
	<meta property="og:type" content="music.song" />

	<meta property="og:image" content="https://i.postimg.cc/D0B9z1Vj/logo-player.png" />
	<meta property="og:image:width" content="640" />
	<meta property="og:image:height" content="640" />

	<meta property="og:audio" content="URL_DE_TU_ARCHIVO_DE_AUDIO.mp3" />
	<meta property="og:audio:type" content="audio/mpeg" />

	<meta property="music:musician" content="Grupo2" />
	<meta property="music:album" content="Instrumental" />
	<meta property="music:release_date" content="2025" />

    <!-- Google Fonts y Phosphor Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            /* Paleta de colores juvenil y minimalista */
            --background: #1A1D24; /* Azul pizarra profundo */
            --surface: #242831; /* Superficie ligeramente más clara */
            --primary-text: #F0F0F0; /* Blanco suave */
            --secondary-text: #8A91A0; /* Gris apagado para texto secundario */
            --accent-color: #00DFB8; /* Menta vibrante */
            --border-color: #3A3F4B;
            --font-main: 'Inter', sans-serif;
            --chord-color: #A485FF; /* Violeta energético para acordes */
            --safe-area-bottom: env(safe-area-inset-bottom, 1rem);
        }

        html {
            font-size: 100%; 
        }

        body {
            font-family: var(--font-main);
            background-color: var(--background);
            color: var(--primary-text);
            margin: 0;
            font-size: 0.875rem; /* 14px */
            overflow: hidden; /* Evitar scroll en el body */
        }

        /* --- Pantalla de Selección de Modo --- */
        #mode-selection-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--background);
            display: flex; justify-content: center; align-items: center;
            z-index: 200; flex-direction: column; padding: 1.25rem;
            box-sizing: border-box; transition: opacity 0.3s ease-in-out;
        }
        .selection-box {
            text-align: center; background-color: var(--surface);
            padding: 2rem; border-radius: 0.75rem;
            box-shadow: 0 0.5rem 1.5625rem rgba(0, 0, 0, 0.4);
        }
        .selection-box h2 { margin-top: 0; color: var(--primary-text); }
        .selection-box p { color: var(--secondary-text); margin-bottom: 1.5rem; }
        .selection-buttons { display: flex; flex-direction: column; gap: 1rem; }
        .selection-buttons button {
            padding: 0.9375rem 1.5rem; font-size: 1rem; font-weight: 600;
            border: none; border-radius: 0.5rem; cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
        }
        .selection-buttons button:hover { transform: scale(1.05); }
        #with-guitar-btn { background-color: var(--accent-color); color: #000; }
        #without-guitar-btn {
            background-color: transparent; color: var(--accent-color);
            border: 2px solid var(--accent-color);
        }

        /* --- Estructura del Reproductor --- */
        .player-container {
            width: 100vw; 
            height: 100vh; /* Fallback */
            height: calc(var(--vh, 1vh) * 100);
            display: flex;
            flex-direction: column; overflow: hidden;
            transition: opacity 0.3s ease-in-out;
        }
        .hidden { opacity: 0; pointer-events: none; }
        .main-view { position: relative; flex-grow: 1; display: flex; overflow: hidden; }

        /* --- Contenedor de Letras (Principal en Móvil) --- */
        .lyrics-container {
            padding: 1.25rem; 
            box-sizing: border-box; overflow-y: auto;
            flex-grow: 1; background-color: var(--surface);
            width: 100%;
        }
        .lyrics-container h3 {
            margin-top: 0; color: var(--secondary-text);
            border-bottom: 0.0625rem solid var(--border-color);
            padding-bottom: 0.625rem;
        }
        #lyrics-display {
            white-space: pre-wrap; line-height: 1.6em; color: var(--primary-text);
            font-size: 1.1em; background-color: transparent; padding: 1rem 0;
        }
        #lyrics-display b { color: var(--accent-color); }
        #lyrics-display .chord { color: var(--chord-color); font-weight: 600; }
        
        /* --- Panel de Playlist (Menú lateral en móvil) --- */
        .playlist-container {
            position: absolute; top: 0; left: 0; bottom: 0;
            width: 80%; max-width: 300px;
            background-color: var(--surface);
            border-right: 0.0625rem solid var(--border-color);
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 150; padding: 1.25rem; box-sizing: border-box;
            overflow-y: auto;
        }
        .playlist-container.is-open { transform: translateX(0); }
        #playlist { list-style: none; padding: 0; margin: 0; }
        #playlist li {
            padding: 0.9375rem; border-radius: 0.5rem; margin-bottom: 0.5rem;
            cursor: pointer; transition: background-color 0.2s, color 0.2s;
            border-bottom: 0.0625rem solid var(--border-color);
        }
        #playlist li:hover { background-color: rgba(255, 255, 255, 0.05); }
        #playlist li.active { background-color: var(--accent-color); color: #000; font-weight: bold; }
        
        /* Estilos para las nuevas opciones */
        #playlist li.playlist-action {
            color: var(--secondary-text);
            font-style: italic;
            border-bottom: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        #playlist li.playlist-action:hover {
            color: var(--accent-color);
            background-color: rgba(0, 223, 184, 0.1);
        }
        #playlist li.playlist-separator {
            height: 1px;
            background-color: var(--border-color);
            margin: 0.5rem 0;
            padding: 0;
            cursor: default;
            border-bottom: none; /* Corrección para evitar doble línea */
        }
         #playlist li.playlist-separator:hover {
            background-color: var(--border-color);
        }


        /* Overlay para cerrar el menú */
        .overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.5); z-index: 140;
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .overlay.is-open { opacity: 1; visibility: visible; }
        
        /* Header con botón de menú */
        .app-header {
            padding: 0.75rem 1.25rem; border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center;
            flex-shrink: 0;
        }
        #playlist-toggle-btn {
            background: none; border: none; color: var(--primary-text);
            padding: 0.5rem; margin-right: 1rem; cursor: pointer;
        }

        /* --- Barra de Reproductor Fija --- */
        .player-controls {
            background-color: rgba(26, 29, 36, 0.8); backdrop-filter: blur(0.625rem);
            padding: 0.9375rem; 
            padding-bottom: calc(0.9375rem + var(--safe-area-bottom)); /* Espacio para la barra del navegador */
            border-top: 0.0625rem solid var(--border-color);
            z-index: 100; flex-shrink: 0;
        }
        #now-playing {
            text-align: center; font-weight: 600; margin-bottom: 0.625rem;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .progress-container {
            width: 100%; height: 0.3125rem; background-color: #4A505C;
            border-radius: 0.15625rem; cursor: pointer; margin-bottom: 0.625rem;
        }
        #progress-bar {
            width: 0%; height: 100%; background-color: var(--accent-color);
            border-radius: 0.15625rem;
        }
        .time-stamps {
            display: flex; justify-content: space-between; font-size: 0.75em;
            color: var(--secondary-text); margin-bottom: 0.3125rem;
        }
        .buttons-container {
            display: flex; justify-content: center; align-items: center; gap: 1.25rem;
        }
        .buttons-container button {
            background: none; border: none; color: var(--primary-text); cursor: pointer;
        }
        .buttons-container button i { font-size: 1.75rem; }
        #play-pause-btn i { font-size: 2.5rem; color: var(--accent-color); }

        ::-webkit-scrollbar { width: 0.5rem; }
        ::-webkit-scrollbar-track { background: var(--surface); }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 0.25rem; }

        /* --- Diseño para Escritorio --- */
        @media screen and (min-width: 48rem) { /* 768px */
            body { justify-content: center; align-items: center; display: flex; min-height: 100vh; }
            .selection-buttons { flex-direction: row; }
            .player-container {
                width: 90%; max-width: 62.5rem; height: 80vh; max-height: 43.75rem;
                border-radius: 0.75rem; box-shadow: 0 0.5rem 1.5625rem rgba(0, 0, 0, 0.6);
                background-color: var(--surface);
                height: 80vh; /* Restaurar vh para desktop */
            }
            #playlist-toggle-btn, .overlay { display: none; } /* Ocultar en escritorio */
            .app-header { display: none; } /* Ocultar header de móvil */

            .main-view { flex-direction: row; }
            .playlist-container {
                display: block; position: static; width: 40%; transform: translateX(0);
                border-bottom: none; border-right: 0.0625rem solid var(--border-color);
            }
            .lyrics-container {
                width: 60%; background-color: var(--background);
            }
            .player-controls { 
                position: static; 
                background-color: var(--surface); 
                padding-bottom: 0.9375rem; /* Restaurar padding */
            }
        }
    </style>
</head>
<body>
    
    <div id="mode-selection-overlay">
        <div class="selection-box">
             <h2>Elige un modo de práctica</h2>
            <p>Selecciona la pista que deseas escuchar.</p>
            <div class="selection-buttons">
                <button id="with-guitar-btn">Secuencia Completa</button>
                <button id="without-guitar-btn">Secuencia sin Guitarra</button>
            </div>
        </div>
    </div>

    <div class="player-container hidden">
        <header class="app-header">
            <button id="playlist-toggle-btn">
                <i class="ph ph-list"></i>
            </button>
            <span id="header-title">Letra y Acordes</span>
        </header>
        <div class="main-view">
            <div class="playlist-container">
                 <h3 id="playlist-title">Lista de Reproducción</h3>
                 <ul id="playlist"></ul>
            </div>
            <div class="lyrics-container">
                 <div id="lyrics-display">Selecciona una canción...</div>
            </div>
            <div class="overlay"></div>
        </div>
        <div class="player-controls">
            <div id="now-playing">Reproductor de Música</div>
            <div class="time-stamps">
                <span id="current-time">0:00</span>
                <span id="total-duration">0:00</span>
            </div>
            <div class="progress-container" id="progress-container">
                <div id="progress-bar"></div>
            </div>
            <div class="buttons-container">
                <button id="prev-btn"><i class="ph ph-skip-back"></i></button>
                <button id="play-pause-btn"><i class="ph-fill ph-play-circle"></i></button>
                <button id="next-btn"><i class="ph ph-skip-forward"></i></button>
            </div>
        </div>
    </div>
    
    <audio id="audio-player"></audio>

    <script>
        // --- VIEWPORT HEIGHT FIX FOR MOBILE BROWSERS ---
        const setVh = () => {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        };
        window.addEventListener('resize', setVh);
        setVh(); // Set initial value

        // --- 1. GESTIÓN DE DATOS ---
        const playlistData = [
            {
                title: "1. Te alabare & Bueno es alabar",
                src: {
                    with_guitar: "https://files.catbox.moe/uuaq9m.mp3",
                    without_guitar: "https://files.catbox.moe/76fz6l.mp3"
                },
                lyrics: `Tono: F
INTRO
F - C - Dm - C D Eb   F - C - Gm- Gm A Bb

Verso
F             C           
Eres tú la única razón  
       Dm            Bb
de mi adoración oh Jesús
F               C         
Eres tú la esperanza que  
    Dm            Bb
anhelé tener oh Jesús

Precoro
Gm                      C              
Confié en ti me has ayudado     
Eb              C
tu salvación me has regalado
F                   C        
Hoy hay gozo en mi corazón  
       Bb           C
con mi canto te alabaré.

Coro
Em        D      Am          C          
Te alabaré;    te glorificaré;   
D            Em                  C
te alabaré mi buen Jesús

Coro
Em        D      Am          C          
Te alabaré;    te glorificaré;   
D            Em                  Eb
te alabaré mi buen Jesús

Puente
Bb F Gm C

F                                        C     
En todo tiempo te alabaré;   
Gm                                    Bb
en todo tiempo te adoraré

Instrumental
D C 
G A Bb

Solo teclado
D C 
G A Bb

Coro
Coro
Coro
Final F

Intro
F G… Bb G (solo bajo)
F G … F
F G… Bb G (todos)
F G … Bb G

Verso
Em                                   D   
Bueno es alabar oh Señor tu nombre
 Em                                   D    
darte gloria, honra y honor por siempre
Em                                   D      
Bueno es alabarte Jesús 
         Am                    F#
Y gozarme en tu Poder

Verso

Em                                   D   
Bueno es alabar oh Señor tu nombre
 Em                                   D    
darte gloria, honra y honor por siempre
Em                                   D      
Bueno es alabarte Jesús 
         Am                     F
Y gozarme en tu Poder

Coro
              G    
Porque Grande eres Tu
Em
Grandes son tus obras
              G     
Porque Grande eres Tu 
                            Am  
Grande es Tu Amor 
                          C
grande es Tu Gloria

Coro

              G    
Porque Grande eres Tu
Em
Grandes son tus obras
              G     
Porque Grande eres Tu 
                            Am  
Grande es Tu Amor 
                          F
grande es Tu Gloria

Instrumental
F G… Bb G

Verso
Verso
Coro X2
Coro
Instrumental
//F G… Bb G
F G … FG//
Final`
            },
	    {
                title: "2. Tu pueblo dice gracias (Ofrenda)",
                src: {
                    with_guitar: "https://files.catbox.moe/84e1h7.mp3",
                    without_guitar: "https://files.catbox.moe/r190n8.mp3"
                },
                lyrics: `Intro
//G D/F# Em7 Cadd9
G D/F# Cadd9//
Arreglo: C B A C D(notas todos)

Verso
G             D/F#
Oh cuan amor inagotable
Em7           C
Fidelidad incomparable
G                  D                C
Grandes cosas ha hecho Dios por su pueblo

Verso
        G                 D/F#
Has sido lluvia a las naciones
Em7                          C
Cambiaste el lloro por canciones
G                                          D                
Grandes cosas ha hecho Dios 
               C
por su pueblo

Precoro
    G                                  D/F#
Y toda la creación se levanta
       Em7                              C
Y delante de su trono proclama
          G           D                  C
que grande y bueno es Dios

Coro
               G      
Tu pueblo dice gracias, 
D/F#             Em7     C
tu pueblo dice gracias,
       G                D
porque grandes cosas ha hecho Dios
         C
por su pueblo

Coro
Arreglo: C B A C D(notas todos)

Verso
Verso
Precoro
Coro
Coro
Arreglo: C B A C D(notas todos)

Coro Suave
Coro

Precoro
Coro
Coro

Repite
Porque grandes cosas ha hecho Dios

Ultima vez
Porque grandes cosas ha hecho Dios

Final
Arreglo: C B A C D B B(notas todos)`
            },
	    {
                title: "3. Dios esta aqui",
                src: {
                    with_guitar: "https://files.catbox.moe/vkhdus.mp3",
                    without_guitar: "https://files.catbox.moe/lkwfgg.mp3"
                },
                lyrics: `Tono: D
| D G | X2

Verso1
D      A/C#  Bm7
Dios está aquí
     G                   A      D  
Tan cierto como el aire que respiro
     G                  A          F#m      Bm
Tan cierto como en la mañana se levanta el so-ol
     Em                    A                  D    
Tan cierto que cuando le hablo, Él me puede oír

Interludio
| D G | X2

Verso1

Coro
              A
Lo puedes sentir, a tu lado
                  D
En este mismo instante
              A
Lo puedes sentir, muy dentro
           D 
De tu corazón

              A
Lo puedes sentir, en ese problema
      Bm7
Que tienes
              A
Jesús está aquí
                             D
Si tú quieres, lo puedes sentir

Verso2
D      A/C#   Bm7          G   Asus4   D   D7
Santo, santo, santo... Mi corazón te adora
    G   Asus4 F#m    Bm7  Em    Asus4 D     
Mi corazón te sabe decir: Santo eres Tú

Repetir
Mi corazón te adora
Mi corazón sabe decir: Santo eres Tú

Instrumental (+ riff 1 guitarra)
Em     G      D      A
Instrumental
Em     G      D      A

Reframe
Em     G      D      A
Santo, santo, santo, Dios

Reframe x3 (+batería +guitarra suave)

Reframe x1 (sube intensidad)

Reframe x3 (todos +riff 2 guitarra)

Reframe x4(baja intensidad)

Final`
            },
	    {
                title: "4. Gracias / Tu Fidelidad",
                src: {
                    with_guitar: "https://files.catbox.moe/9i81dk.mp3",
                    without_guitar: "https://files.catbox.moe/e4ezuo.mp3"
                },
                lyrics: ``
            }
           // ... resto de canciones
 ];

        // --- 2. REFERENCIAS A ELEMENTOS DEL DOM ---
        const modeSelectionOverlay = document.getElementById('mode-selection-overlay');
        const playerContainer = document.querySelector('.player-container');
        const withGuitarBtn = document.getElementById('with-guitar-btn');
        const withoutGuitarBtn = document.getElementById('without-guitar-btn');
        const audioPlayer = document.getElementById('audio-player');
        const playlistEl = document.getElementById('playlist');
        const lyricsDisplayEl = document.getElementById('lyrics-display');
        const nowPlayingEl = document.getElementById('now-playing');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const currentTimeEl = document.getElementById('current-time');
        const totalDurationEl = document.getElementById('total-duration');
        const playlistToggleBtn = document.getElementById('playlist-toggle-btn');
        const playlistContainer = document.querySelector('.playlist-container');
        const overlay = document.querySelector('.overlay');
        const playlistTitleEl = document.getElementById('playlist-title');

        let currentTrackIndex = 0;
        let isPlaying = false;
        let currentMode = 'with_guitar';
        let initialPlaylistShown = false;

        // --- 3. FUNCIONES PRINCIPALES ---

        function initPlayer(mode) {
            currentMode = mode;
            modeSelectionOverlay.classList.add('hidden');
            playerContainer.classList.remove('hidden');

            playlistTitleEl.innerHTML = `Lista de Reproducción v0149`;

            populatePlaylist();
            loadTrack(0);
            playTrack();

            if (window.innerWidth < 768 && !initialPlaylistShown) {
                initialPlaylistShown = true; 
                togglePlaylist(); 
                setTimeout(() => {
                    if (playlistContainer.classList.contains('is-open')) {
                        togglePlaylist(); 
                    }
                }, 5000);
            }
        }
        
        function goBackToSelection() {
            pauseTrack();
            playerContainer.classList.add('hidden');
            modeSelectionOverlay.classList.remove('hidden');
            currentTrackIndex = 0;
            initialPlaylistShown = false;
        }

        function hardRefresh() {
            location.reload(true);
        }

        function togglePlaylist() {
            playlistContainer.classList.toggle('is-open');
            overlay.classList.toggle('is-open');
        }

        function isChordLine(line) {
            const trimmedLine = line.trim();
            if (trimmedLine.length === 0) return false;
            const chordPattern = /([A-G](#|b)?(m|maj|min|dim|aug|sus)?[2-79]?(\/[A-G](#|b)?)?)/g;
            const nonChordChars = trimmedLine.replace(chordPattern, '').replace(/[\s/()|x\d]/g, '');
            return nonChordChars.length < trimmedLine.length * 0.25;
        }

        function parseLyrics(lyricText) {
            if (!lyricText || lyricText.trim().startsWith("No hay letra")) {
                return "No hay letra disponible para esta canción.";
            }
            const lines = lyricText.split('\n');
            let html = '';
            const sectionTitles = ['intro', 'verse', 'verso', 'precoro', 'chorus', 'coro', 'puente', 'bridge', 'solo', 'salida', 'final', 'vozcoro', 'reframe', 'instrumental', 'interlude'];
            const chordRegex = /\b([A-G](?:#|b)?(?:maj|min|m|sus|dim|aug|add)?[2-79]?(?:\/[A-G][#b]?)?)\b/g;

            for (const line of lines) {
                const trimmedLine = line.trim();
                if (trimmedLine === '') { html += '\n'; continue; }
                const firstWord = trimmedLine.split(' ')[0].toLowerCase().replace(/x\d|\d|:|\(|\)/g, '');
                if (sectionTitles.includes(firstWord)) {
                     html += `<b>${trimmedLine}</b>\n`;
                } else if (isChordLine(line)) {
                     const coloredLine = trimmedLine.replace(chordRegex, '<span class="chord">$&</span>');
                     html += `${coloredLine}\n`;
                } else {
                     html += `${trimmedLine}\n`;
                }
            }
            return html;
        }

        function loadTrack(trackIndex) {
            currentTrackIndex = trackIndex;
            const track = playlistData[trackIndex];
            audioPlayer.src = track.src[currentMode]; 
            nowPlayingEl.textContent = track.title;
            lyricsDisplayEl.innerHTML = parseLyrics(track.lyrics);
            updatePlaylistUI();
        }

        function playTrack() {
            const playPromise = audioPlayer.play();
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    isPlaying = true;
                    playPauseBtn.innerHTML = '<i class="ph-fill ph-pause-circle"></i>';
                }).catch(error => {
                    if (error.name !== 'AbortError') {
                        console.error("Audio playback error:", error);
                        isPlaying = false;
                        playPauseBtn.innerHTML = '<i class="ph-fill ph-play-circle"></i>';
                    }
                });
            }
        }

        function pauseTrack() {
            isPlaying = false;
            audioPlayer.pause();
            playPauseBtn.innerHTML = '<i class="ph-fill ph-play-circle"></i>';
        }

        function playPauseTrack() { isPlaying ? pauseTrack() : playTrack(); }
        
        function nextTrack() {
            currentTrackIndex = (currentTrackIndex + 1) % playlistData.length;
            loadTrack(currentTrackIndex);
            playTrack();
        }
        
        function prevTrack() {
            currentTrackIndex = (currentTrackIndex - 1 + playlistData.length) % playlistData.length;
            loadTrack(currentTrackIndex);
            playTrack();
        }
        
        function updateProgress(e) {
            const { duration, currentTime } = e.srcElement;
            const progressPercent = (currentTime / duration) * 100;
            progressBar.style.width = `${progressPercent}%`;
            totalDurationEl.textContent = formatTime(duration);
            currentTimeEl.textContent = formatTime(currentTime);
        }

        function setProgress(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audioPlayer.duration;
            audioPlayer.currentTime = (clickX / width) * duration;
        }
        
        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function updatePlaylistUI() {
            Array.from(playlistEl.children).forEach((item, index) => {
                if (index === currentTrackIndex) { item.classList.add('active');
                } else { item.classList.remove('active'); }
            });
        }
        
        function populatePlaylist() {
            playlistEl.innerHTML = '';
            playlistData.forEach((track, index) => {
                const li = document.createElement('li');
                li.textContent = track.title;
                li.addEventListener('click', () => {
                    loadTrack(index);
                    playTrack();
                    if (window.innerWidth < 768) {
                        togglePlaylist();
                    }
                });
                playlistEl.appendChild(li);
            });
            
            const songItems = playlistEl.querySelectorAll('li:not(.playlist-action):not(.playlist-separator)');
            if (songItems.length > 0) {
                songItems[songItems.length - 1].style.borderBottom = 'none';
            }

            const separator = document.createElement('li');
            separator.className = 'playlist-separator';
            
            const actionLi = document.createElement('li');
            actionLi.className = 'playlist-action';
            actionLi.innerHTML = `<i class="ph ph-arrow-left"></i> Volver a las opciones`;
            actionLi.addEventListener('click', goBackToSelection);

            playlistEl.appendChild(separator);
            playlistEl.appendChild(actionLi);
        }
        
        // --- 4. INICIALIZACIÓN Y EVENT LISTENERS ---
        withGuitarBtn.addEventListener('click', () => initPlayer('with_guitar'));
        withoutGuitarBtn.addEventListener('click', () => initPlayer('without_guitar'));
        
        playlistToggleBtn.addEventListener('click', () => {
            const isOpening = !playlistContainer.classList.contains('is-open');
            togglePlaylist();
            if (isOpening && window.innerWidth < 768) {
                setTimeout(() => {
                    if (playlistContainer.classList.contains('is-open')) {
                        togglePlaylist();
                    }
                }, 5000);
            }
        });
        overlay.addEventListener('click', togglePlaylist);

        playPauseBtn.addEventListener('click', playPauseTrack);
        nextBtn.addEventListener('click', nextTrack);
        prevBtn.addEventListener('click', prevTrack);
        audioPlayer.addEventListener('timeupdate', updateProgress);
        audioPlayer.addEventListener('ended', nextTrack);
        progressContainer.addEventListener('click', setProgress);
        audioPlayer.addEventListener('loadedmetadata', () => {
             totalDurationEl.textContent = formatTime(audioPlayer.duration);
        });

    </script>
</body>
</html>



