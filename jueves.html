<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro de Asistencia v4 (Móvil)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    /* Nueva paleta de colores armonizada */
    --color-perfect: #00796b; /* Verde azulado para 100%+ */
    --color-perfect-bg: #e0f2f1;
    --color-warning: #ffa000; /* Ámbar para progreso intermedio */
    --color-warning-bg: #fff3e0;
    --color-fail: #ef5350;    /* Rojo suave para no cumplido */
    --color-fail-bg: #ffebee;
    --color-pendiente: #6c757d;
    --color-pendiente-bg: #f8f9fa;
    
    --brand-color: var(--color-perfect); /* El color de marca ahora es el color de "éxito" */
    --text-color: #212529;
    --background-color: #f4f7f9;
    --border-color: #e9ecef;
  }

  body {
    font-family: 'Poppins', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin: 0;
    background-color: var(--background-color);
    color: var(--text-color);
    font-size: 16px;
  }
  .main-container {
    padding: 1rem;
  }
  .header {
    background-color: var(--brand-color);
    color: white;
    padding: 1.5rem 1rem;
    text-align: center;
    border-radius: 0 0 20px 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin: -1rem -1rem 0 -1rem; /* Extend to screen edges */
  }
  .header h2 {
    margin: 0;
    font-weight: 700;
  }
  .header p {
    margin: 0.25rem 0 0;
    opacity: 0.9;
    font-weight: 400;
  }
  
  /* --- Resumen Superior --- */
  .summary-section {
    display: flex;
    justify-content: space-around;
    background-color: white;
    padding: 1rem;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    margin-top: 1.5rem;
    text-align: center;
  }
  .summary-item {
    flex-grow: 1;
  }
  .summary-item .day {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--color-pendiente);
    text-transform: uppercase;
  }
  .summary-item .count {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--brand-color);
  }

  /* --- Tabla Resumen General --- */
  .summary-table-container {
    background-color: white;
    padding: 1rem;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    margin-top: 1.5rem;
  }
  .summary-table-title {
    margin: 0 0 1rem 0;
    font-size: 1.2rem;
    color: var(--brand-color);
    text-align: center;
    font-weight: 600;
  }
  .table-wrapper {
      overflow-x: auto; /* Para scroll horizontal si es necesario */
  }
  .summary-table {
      width: 100%;
      border-collapse: collapse;
  }
  .summary-table th, .summary-table td {
      padding: 0.75rem 0.5rem;
      text-align: center;
      border-bottom: 1px solid var(--border-color);
      font-size: 0.9rem;
      white-space: nowrap;
      vertical-align: middle;
  }
  .summary-table th {
      font-weight: 600;
      background-color: #f8f9fa;
      text-transform: uppercase;
      font-size: 0.75rem;
      color: #495057;
  }
  .summary-table td:first-child {
      text-align: center;
      font-weight: 500;
  }
  .summary-table tbody tr:nth-child(even) {
      background-color: #f8f9fa;
  }
  .summary-table tbody tr:last-child td {
      border-bottom: none;
  }

  /* --- Nuevo Diseño de Etiquetas de Estado (UX) --- */
  .status-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    border-radius: 50em;
    font-weight: 600;
    font-size: 0.8rem;
  }
  .status-tag svg {
    width: 14px;
    height: 14px;
  }
  .tag-cumplido {
    color: var(--color-perfect);
    background-color: var(--color-perfect-bg);
  }
  .tag-cumplido svg {
    fill: var(--color-perfect);
  }
  .tag-incompleto {
    color: var(--color-pendiente);
    background-color: var(--color-pendiente-bg);
  }
  .tag-incompleto svg {
    fill: var(--color-pendiente);
  }


  /* --- Lista de Tarjetas de Asistencia --- */
  .attendance-list {
    margin-top: 1.5rem;
    display: grid;
    gap: 1rem;
  }
  .person-card {
    background-color: #ffffff;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    padding: 1rem;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .person-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  }
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 0.75rem;
    margin-bottom: 0.75rem;
  }
  .person-name {
    font-weight: 600;
    font-size: 1.2rem;
    color: var(--brand-color);
  }
  .progress-container {
      display: flex;
      align-items: center;
  }
  .progress-bar-bg {
      width: 80px;
      background-color: #e9ecef;
      border-radius: 6px;
      overflow: hidden;
      height: 8px;
      margin-left: 8px;
  }
  .progress-bar {
      height: 100%;
      background-color: var(--brand-color);
      border-radius: 6px;
      transition: width 0.3s ease-in-out;
  }
  .percentage-text {
      font-weight: 600;
      font-size: 0.9rem;
  }

  .card-body {
    display: grid;
    gap: 0.75rem;
  }
  .attendance-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f8f9fa;
    padding: 0.5rem 1rem;
    border-radius: 8px;
  }
  .attendance-day {
      font-weight: 500;
      color: #495057;
  }
  .status-badge {
    border-radius: 12px;
    padding: 0.25rem 0.75rem;
    font-weight: 600;
    font-size: 0.8rem;
    cursor: pointer;
    width: 85px;
    text-align: center;
  }
  .status-presente { color: var(--color-perfect); background-color: var(--color-perfect-bg); border: 1px solid var(--color-perfect);}
  .status-falta { color: var(--color-fail); background-color: var(--color-fail-bg); border: 1px solid var(--color-fail);}
  .status-pendiente { color: var(--color-pendiente); background-color: var(--color-pendiente-bg); border: 1px solid #ced4da;}

</style>
</head>
<body>

<div class="header">
  <h2>CULTOS DE ORACIÓN</h2>
  <p>Asistencia - Setiembre 2025</p>
</div>

<div class="main-container">
  <div id="summary-section" class="summary-section">
    <!-- Resumen diario se generará aquí -->
  </div>

  <div id="summary-table-container">
    <!-- Tabla de resumen general se generará aquí -->
  </div>

  <div id="attendance-list" class="attendance-list">
    <!-- Tarjetas de personas se generarán aquí -->
  </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const year = 2025;
    const month = 8;
    const names = ["JEA", "ART", "YHA", "CRI", "LEO", "KAR", "LUI", "JOS", "ERI", "KAT", "JUA", "HP", "JAI"];
    names.sort();

    let attendanceData = {
        '11': { 'CRI': 'presente', 'JAI': 'presente' },
        '18': { 'HP': 'presente', 'JAI': 'presente', 'LEO': 'presente', 'YHA': 'presente' },
        '25': { 'JUA': 'presente', 'HP': 'presente' }
    };

    const summarySection = document.getElementById("summary-section");
    const summaryTableContainer = document.getElementById("summary-table-container");
    const attendanceList = document.getElementById("attendance-list");

    const statusText = { presente: 'Presente', falta: 'Falta', pendiente: 'Incompleto' };
    const statusCycle = ['pendiente', 'presente', 'falta'];

    // Iconos SVG para los estados de la tabla de resumen
    const icons = {
        cumplido: `<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>`,
        parcial: `<svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>`,
        noAsistio: `<svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>`
    };

    function getThursdaysInMonth(year, month) {
        const thursdays = [];
        const date = new Date(year, month, 1);
        while (date.getDay() !== 4) { date.setDate(date.getDate() + 1); }
        while (date.getMonth() === month) {
            thursdays.push(date.getDate());
            date.setDate(date.getDate() + 7);
        }
        return thursdays;
    }

    const thursdaysOfMonth = getThursdaysInMonth(year, month);

    function renderApp() {
        attendanceList.innerHTML = '';
        
        names.forEach(name => {
            const card = document.createElement('div');
            card.className = 'person-card';
            card.dataset.name = name;

            let cardBodyHTML = '';
            thursdaysOfMonth.forEach(day => {
                const dayStr = day.toString();
                if (!attendanceData[dayStr]) attendanceData[dayStr] = {};
                const status = attendanceData[dayStr][name] || 'pendiente';
                cardBodyHTML += `
                    <div class="attendance-item">
                        <span class="attendance-day">Jueves ${dayStr}</span>
                        <div class="status-badge status-${status.replace('presente', 'perfect')}" data-name="${name}" data-day="${dayStr}">
                            ${statusText[status]}
                        </div>
                    </div>
                `;
            });
            
            card.innerHTML = `
                <div class="card-header">
                    <span class="person-name">${name}</span>
                    <div class="progress-container">
                        <span class="percentage-text">0%</span>
                        <div class="progress-bar-bg">
                            <div class="progress-bar" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    ${cardBodyHTML}
                </div>
            `;
            
            attendanceList.appendChild(card);
            updatePersonSummary(name);
        });

        document.querySelectorAll('.status-badge').forEach(badge => {
            badge.addEventListener('click', toggleStatus);
        });

        updateSummarySection();
        renderSummaryTable();
    }
    
    function toggleStatus(event) {
        const { name, day } = event.currentTarget.dataset;
        const currentStatus = attendanceData[day][name] || 'pendiente';
        const currentIndex = statusCycle.indexOf(currentStatus);
        const nextStatus = statusCycle[(currentIndex + 1) % statusCycle.length];
        
        attendanceData[day][name] = nextStatus;
        
        const badge = event.currentTarget;
        badge.className = `status-badge status-${nextStatus.replace('presente', 'perfect')}`;
        badge.textContent = statusText[nextStatus];
        
        updateSummarySection();
        updatePersonSummary(name);
        renderSummaryTable(); // Re-render summary table on change
    }
    
    function updatePersonSummary(name) {
        let presentCount = 0;
        thursdaysOfMonth.forEach(day => {
            if (attendanceData[day.toString()] && attendanceData[day.toString()][name] === 'presente') {
                presentCount++;
            }
        });

        const asistenciaMinima = 2;
        // El porcentaje ahora refleja la finalización del objetivo mínimo
        const percentage = asistenciaMinima > 0 ? Math.round((presentCount / asistenciaMinima) * 100) : 0;
        // Se limita la barra visual al 100% por estética, pero se muestra el porcentaje real
        const progressBarWidth = Math.min(percentage, 100);

        const card = attendanceList.querySelector(`.person-card[data-name="${name}"]`);
        if (card) {
            card.querySelector('.percentage-text').textContent = `${percentage}%`;
            card.querySelector('.progress-bar').style.width = `${progressBarWidth}%`;
        }
    }

    function updateSummarySection() {
        summarySection.innerHTML = '';
        thursdaysOfMonth.forEach(day => {
            const dayStr = day.toString();
            let presentCount = 0;
            if (attendanceData[dayStr]) {
                presentCount = Object.values(attendanceData[dayStr]).filter(s => s === 'presente').length;
            }

            const summaryItem = document.createElement('div');
            summaryItem.className = 'summary-item';
            summaryItem.innerHTML = `
                <div class="day">Jueves ${dayStr}</div>
                <div class="count">${presentCount}</div>
            `;
            summarySection.appendChild(summaryItem);
        });
    }

    function renderSummaryTable() {
        let tableHTML = `
            <div class="summary-table-container">
                <h3 class="summary-table-title">Resumen General</h3>
                <div class="table-wrapper">
                    <table class="summary-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Asistencia minima</th>
                                <th>días asistidos</th>
                                <th>% Asistencia</th>
                            </tr>
                        </thead>
                        <tbody>`;

        names.forEach(name => {
            let presentCount = 0;
            thursdaysOfMonth.forEach(day => {
                if (attendanceData[day.toString()] && attendanceData[day.toString()][name] === 'presente') {
                    presentCount++;
                }
            });
            
            const asistenciaMinima = 2;
            
            let statusClass, statusIcon, statusLabel;

            if (presentCount >= asistenciaMinima) {
                statusClass = 'tag-cumplido';
                statusIcon = icons.cumplido;
                statusLabel = 'Cumplido';
            } else {
                statusClass = 'tag-incompleto'; // Clase gris unificada
                if (presentCount > 0) {
                    statusIcon = icons.parcial;
                    statusLabel = 'Asistencia Parcial';
                } else {
                    statusIcon = icons.noAsistio;
                    statusLabel = 'No asistió';
                }
            }

            const statusTagHTML = `
                <div class="status-tag ${statusClass}">
                    ${statusIcon}
                    <span>${statusLabel}</span>
                </div>
            `;

            tableHTML += `
                <tr>
                    <td>${name}</td>
                    <td>${asistenciaMinima}</td>
                    <td>${presentCount > 0 ? presentCount : ''}</td>
                    <td>${statusTagHTML}</td>
                </tr>
            `;
        });

        tableHTML += `</tbody></table></div></div>`;
        summaryTableContainer.innerHTML = tableHTML;
    }

    renderApp();
});
</script>

</body>
</html>



